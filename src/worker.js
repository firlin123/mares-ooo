const MARE_OOOS = [
    { file: 'img/linky/1.png', source: 'https://derpicdn.net/img/view/2024/6/15/3383980.png', alt: 'Linkooo' },
    { file: 'img/cloud-kicker/1.png', source: 'https://derpicdn.net/img/download/2021/8/28/2688692.png', alt: 'Cloud Kicker oooing' },
    { file: 'img/fluttershy/1.png', source: 'https://derpicdn.net/img/download/2024/5/14/3363764.png', alt: 'Flooooootershy' },
    { file: 'img/trixie/1.jpg', source: 'https://derpicdn.net/img/download/2022/2/14/2806847.jpg', alt: 'Great and Powerfoooool' },
    { file: 'img/cherry-berry/1.png', source: 'https://derpicdn.net/img/download/2021/6/18/2637961.png', alt: 'It\'s just so much to dooooo' },
    { file: 'img/carrot-top/1.png', source: 'https://derpicdn.net/img/download/2021/6/17/2637311.png', alt: 'It\'s just so much to dooooo' },
    { file: 'img/twilight-sparkle/1.gif', source: 'https://derpicdn.net/img/download/2015/12/21/1049299.gif', alt: 'Twi ooo' },
    { file: 'img/starlight-glimmer/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1673/28/1673280285649.png', alt: 'Starlight ooo' },
    { file: 'img/starlight-glimmer/2.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1687/11/1687112778739.png', alt: 'Starlight ooo' },
    { file: 'img/unknown/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1638/65/1638658092189.png', alt: 'Obscure mare ooo' },
    { file: 'img/fluttershy/2.png', source: 'https://derpicdn.net/img/download/2018/10/27/1867701.png', alt: 'Flutter ooo' },
    { file: 'img/luna/1.jpg', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1366/33/1366330264809.jpg', alt: 'Loooona' },
    { file: 'img/applejack/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1616/35/1616351674956.png', alt: 'Applejack ooo' },
    { file: 'img/luna/2.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1616/35/1616351674956.png', alt: 'Nigthmare Moooooon' },
    { file: 'img/multi-ooos/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1616/33/1616339998353.png', alt: 'Linky, Ruby Pinch, and Bon Bon ooo' },
    { file: 'img/multi-ooos/2.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1616/33/1616339998353.png', alt: 'Daisy, Applejack, and Twilight ooo' },
    { file: 'img/lemon-hearts/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1622/51/1622510200783.png', alt: 'Lemon Hearts ooo' },
    { file: 'img/lightning-bolt/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1622/51/1622510200783.png', alt: 'Lightning Bolt ooo' },
    { file: 'img/rarity/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1438/36/1438364855225.png', alt: 'Rarity ooo' },
    { file: 'img/lily-valley/1.gif', source: 'https://derpicdn.net/img/download/2016/9/13/1248117.gif', alt: 'Lily Valley ooo' },
    { file: 'img/fluttershy/3.png', source: 'https://derpicdn.net/img/download/2018/10/29/1869333.png', alt: 'Fluttershy ooo' },
    { file: 'img/rainbow-dash/1.jpg', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1616/52/1616525586183.jpg', alt: 'Rainbow ooo' },
    { file: 'img/applejack/2.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1426/75/1426750530777.png', alt: 'Appoooool' },
    { file: 'img/applejack/3.gif', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1614/88/1614884292789.gif', alt: 'Appul ooo' },
    { file: 'img/twilight-sparkle/2.jpg', source: 'S01E08 - Look before you sleep', alt: 'Twilight ooo' },
    { file: 'img/pinkie-pie/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1389/47/1389475641348.png', alt: 'Ponk ooo' },
    { file: 'img/twilight-sparkle/3.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1628/19/1628196256020.png', alt: 'Twilight ooo' },
    { file: 'img/berry-punch/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1624/85/1624851036061.png', alt: 'Berry Cam ooo' },
    { file: 'img/twilight-sparkle/4.png', source: 'https://derpicdn.net/img/download/2012/7/7/35567.gif', alt: 'You are from the fooooooture?' },
    { file: 'img/pinkie-pie/2.gif', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1489/86/1489867908850.gif', alt: 'Ponk ooo dance' },
    { file: 'img/twilight-sparkle/5.jpg', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1616/14/1616149083626.jpg', alt: 'Twilight ooo' },
    { file: 'img/sea-swirl/1.gif', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1442/14/1442141572316.gif', alt: 'Sea Swirl what are you thinking my dear? You haven\'t got the bits to be shopping \'round here' },
    { file: 'img/coco-pommel/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1436/85/1436858134074.png', alt: 'Coco ooo' },
    { file: 'img/autumn-blaze/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1543/22/1543226108843.png', alt: 'Autoooomn Blaze' },
    { file: 'img/berry-punch/2.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1417/83/1417835381715.png', alt: '>tfw no booooooze' },
    { file: 'img/twilight-sparkle/6.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1635/26/1635260019184.png', alt: 'Booooook horse' },
    { file: 'img/rainbow-dash/2.jpg', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1439/05/1439050443630.jpg', alt: 'Rainbow ooo' },
    { file: 'img/beauty-brass/1.png', source: 'https://derpicdn.net/img/download/2015/3/15/849600.png', alt: 'Toooooooot' },
    { file: 'img/twilight-sparkle/7.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1616/30/1616304969631.png', alt: 'Twilight ooo' },
    { file: 'img/minuette/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1436/04/1436040184880.png', alt: 'Minoooooette' },
    { file: 'img/starlight-glimmer/3.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1609/42/1609427144262.png', alt: 'Starlight ooo' },
    { file: 'img/applejack/4.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1401/32/1401329092600.png', alt: 'Appl ooo' },
    { file: 'img/twilight-sparkle/8.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1613/38/1613380020441.png', alt: 'Twi balooooon' },
    { file: 'img/twilight-sparkle/9.jpg', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1615/66/1615664580015.jpg', alt: 'Twilight ooo' },
    { file: 'img/lightning-bolt/2.png', source: 'https://derpicdn.net/img/download/2024/7/13/3401026.png', alt: 'Lightning Bolt ooo' },
    { file: 'img/rarity/2.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1611/47/1611479952303.png', alt: 'Rarity ooo' },
    { file: 'img/berry-punch/3.gif', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1493/84/1493844865702.gif', alt: 'Berry workoooooout' },
    { file: 'img/rarity/3.jpg', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1616/39/1616399055477.jpg', alt: 'Rarity ooo' },
    { file: 'img/multi-ooos/3.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1615/67/1615671649138.png', alt: 'Rarity and Celestia ooo' },
    { file: 'img/lyra-heartstrings/1.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1638/65/1638656822143.png', alt: 'Lyrooooo' },
    { file: 'img/twilight-sparkle/10.png', source: 'https://derpicdn.net/img/download/2019/3/3/1975965.png', alt: 'Twilight ooo' },
    { file: 'img/amethyst-star/1.gif', source: 'https://derpicdn.net/img/download/2024/7/13/3401055.gif', alt: 'Amethyst wooohooo' },
    { file: 'img/pinkie-pie/3.png', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1418/36/1418360149929.png', alt: 'Ooooh she\'s goooood' },
    { file: 'img/lyra-heartstrings/2.gif', source: 'https://desu-usergeneratedcontent.xyz/mlp/image/1329/54/1329545895182.gif', alt: 'Lyra ooo' },
    { file: 'img/marble-pie/1.png', source: 'https://kissable.bluefast.horse/yjzrqcsj.png', alt: 'Marble ooo' },
    { file: 'img/limestone-pie/1.png', source: 'https://kissable.bluefast.horse/ej8mq1r.png', alt: 'Limestone ooo' },
    // TODOOOOO: Add more
];

// ffmpeg -i /media/firlin123/NTFS-PART/002_Sorted_HDD/MLP/mlp-fim_s1\[1080P\]/YP-1R-01x06.mkv -vf "crop=484:558:802:522" -ss 00:06:12.289 -to 00:06:14.750 frames/%04d.png

function createHtmlResponse(head, body, headers = {}, status = 200) {
    headers = headers || {};
    status = status || 200;
    headers['Content-Type'] = 'text/html; charset=utf-8';
    return new Response(`<!DOCTYPE html>
<html>
    <head>${head}</head>
    <body>${body}</body>
</html>`, { headers, status });
}

function redirect(url) {
    return createHtmlResponse(
        `<title>Redirecting to ${url}...</title><meta http-equiv="refresh" content="0; url="${url}">`,
        `<p>Redirecting to <a href="${url}">${url}</a></p>`,
        { Location: url },
        302
    );
}

const STYLE = `html {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
}

body {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    margin: 0;
}

img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background-color: black;
}`;

export default {
    async fetch(request, env, ctx) {
        let url = new URL(request.url);
        if (url.pathname === '/favicon.ico') {
            return fetch('https://firlin123.github.io/mares-ooo/img/favicon.ico');
        }
        if (url.hostname === 'submit.mares.ooo' || url.hostname === 'www.submit.mares.ooo') {
            return redirect('https://github.com/firlin123/mares-ooo/issues/new');
        }
        const randomMareOoo = MARE_OOOS[Math.floor(Math.random() * MARE_OOOS.length)];
        return createHtmlResponse(
            `<title>Mares.ooo</title><style>${STYLE}</style>`,
            `<!-- Source: ${randomMareOoo.source} --><img src="https://firlin123.github.io/mares-ooo/${randomMareOoo.file}" alt="${randomMareOoo.alt}">`
        );
    }
};